id: scw:dependencies:maven-owasp-dep-check-add-plugin
version: 10
metadata:
  name: Add OWASP Dependency Checker to warn about vulnerable dependencies
  shortDescription: Add OWASP Dependency Checker to warn about vulnerable dependencies
  level: warning
  language: xml
  enabled: true
  tags: Apache Maven;security;OWASP Top 10
search:
  element:
    in:
      file:
        name: pom.xml
    tagName: http://maven.apache.org/POM/4.0.0:project
    child:
      tagName:
        is: build
      child:
        label: plugins
        tagName:
          is: plugins
        without:
          child:
            allOf:
            - child:
                text: org.owasp
                tagName:
                  is: groupId
            - child:
                text: dependency-check-maven
                tagName:
                  is: artifactId
            tagName:
              is: plugin
availableFixes:
- name: Add OWASP Dependency-Check plugin
  actions:
  - add:
      childElement:
        code: |-
          <plugin>
            <groupId>org.owasp</groupId>
            <artifactId>dependency-check-maven</artifactId>
            <version>6.5.0</version>
            <configuration>
              <!-- <failBuildOnCVSS>4</failBuildOnCVSS> -->
            </configuration>
            <executions>
              <execution>
                <goals>
                  <goal>check</goal>
                </goals>
              </execution>
            </executions>
          </plugin>
      target: label:plugins
