id: scw:dependencies:maven-owasp-dep-check-add-plugins
version: 10
metadata:
  name: Add OWASP Dependency Checker to warn about vulnerable dependencies
  shortDescription: Add OWASP Dependency Checker to warn about vulnerable dependencies
  level: warning
  language: xml
  enabled: true
  tags: Apache Maven;security;OWASP Top 10
search:
  element:
    in:
      file:
        name: pom.xml
    with:
      child:
        label: build
        tagName:
          is: build
        without:
          child:
            tagName:
              is: plugins
    tagName: http://maven.apache.org/POM/4.0.0:project
availableFixes:
- name: Add OWASP Dependency-Check plugin (new plugins section)
  actions:
  - add:
      childElement:
        code: |-
          <plugins>
            <plugin>
              <groupId>org.owasp</groupId>
              <artifactId>dependency-check-maven</artifactId>
              <version>6.5.0</version>
              <configuration>
                <!-- <failBuildOnCVSS>4</failBuildOnCVSS> -->
              </configuration>
              <executions>
                <execution>
                  <goals>
                    <goal>check</goal>
                  </goals>
                </execution>
              </executions>
            </plugin>
          </plugins>
      target: label:build
