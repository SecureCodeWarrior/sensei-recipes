id: scw:java:race-conditions:volatile-field-boolean-init
version: 9
metadata:
  name: 'Possible Race Condition: Volatile field (boolean, init)'
  shortDescription: This field might lead to a race condition as it is assigned in this runnable class
  level: warning
  language: java
  enabled: true
  descriptionFile: descriptions/Possible_Race_Condition__Volatile_field.html
search:
  field:
    in:
      class:
        super:
          name: java.lang.Runnable
        child:
          method:
            label: usingMethod
            child:
              assignment:
                label: usage
    type: boolean
    without:
      modifier: volatile
availableFixes:
- name: Make this field volatile
  actions:
  - changeModifiers:
      volatile: true
- name: Make the methods using this field synchronized
  actions:
  - changeModifiers:
      synchronized: true
      target: label:usingMethod
- name: Change type to AtomicBoolean
  actions:
  - rewrite:
      to: '{{{ qualifier }}}.set({{{ assignedExpression }}})'
      target: label:usage
  - rewrite:
      to: '{{{ modifierList }}} java.util.concurrent.atomic.AtomicBoolean {{{ name }}} = new java.util.concurrent.atomic.AtomicBoolean({{{ assignedExpression }}});'
